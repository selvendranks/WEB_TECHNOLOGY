<%layout('layouts/boilerplate') %>

    <div class="row">
        <% if(profile.username == currentUser.username){%>
        <h2>Your Profile</h2>
        <% }else {%>
            <h2> <%=profile.username %> Profile</h2>
        <% } %> 
            
        <div class="col-md-6 offset-md-3">
            
            <div class="card m-2 d-inline-block" style="width: 27rem;">
                <img src="<%= profile.image.url %> " alt="" class="card-img-top">

                <div class="card-body">
                    <h4 class="card-title">
                        <%= profile.username %>
                    </h4>
                    <p class="card-text" style="font-size: large;"><b>Description : </b>
                        <%= profile.description %>
                    </p>
                    
                    <p class="card-text" style="font-size: large;"><b>Email : </b>
                        <%= profile.email %>
                    </p>
                    <p class="card-text" style="font-size: large;"><b>Gender : </b>
                        <%= profile.Gender %>
                    </p>
                    <p class="card-text" style="font-size: large;"><b>Friends : </b>
                        <%= profile.friends.length %>
                    </p>
                    <p class="card-text" style="font-size: large;"><b>Posts : </b>
                        <%= profile.postsNo %>
                    </p>
                    <p class="card-text" style="font-size: large;"><b>Date Of Birth : </b>
                        <%= profile.dateOfBirth %>
                    </p>
                    <% if(profile.username == currentUser.username) { %> 
                    <a href="/friends/<%= profile._id %>/edit" class="btn btn-warning"> Edit</a>
                    <% } %> 
                </div>
            </div>
        </div>
            
            <h2>Posts 
                <% if(profile.username == currentUser.username){%> 
                <a href="/friends/<%= profile._id %>/post" class="btn btn-primary m-2">Add New Post</a>
               <% } %> 
            </h2>
            <ul>
                <%for (let post of profile.posts) {%>
                    <div class="card m-2 d-inline-block" style="width: 18rem;">
    
                            <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
                            
                                <% if(post.image.length>1){ %>  
                                <div class="carousel-indicators">
                                    <% post.image.forEach((img,i) => { %>
                                      <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="<%= i %> " class="<%= i===0 ? 'active' : '' %>" aria-current="<%= i===0 ? 'true' : '' %>"></button>
                                    <% }) %> 
                                  </div>
                                <% } %> 
                                
                                <div class="carousel-inner">
                                    <% post.image.forEach((img,i) => { %>
                                  <div class="carousel-item <%= i===0 ? 'active' : '' %> ">
                                    <img src="<%= img.url %>" class="d-block w-100" alt="...">
                                  </div>
                                  <% }) %> 
                                 
                                </div>
                        
                              </div>
                    

                        
                        <div class="card-body">
                            <h5 class="card-title">
                                <%= post.title %>
                            </h5>
                            <p class="card-text">
                                <%= post.description %>
                            </p>
                        </div>
                        <ul class="list-group list-group-flush">
                            <% if(profile.username == currentUser.username){%>
                            <li class="list-group-item" style='font-size:1.2rem;'><b>&#9829 </b><%= post.likes.length %>
                            <% }else {%> 
                                <div>
                                <form action="/friends/<%=profile.id %>/post/<%= post.id %>/like" method="post">
                                    <button class="btn-sm btn-pink"  style='font-size:1.2rem;text-decoration: none;'><b>&#9829</b></button>Likes: <%= post.likes.length %>
                                </form>
                                </div>
                                <div>
                                  <form action="/friends/<%=profile.id %>/post/<%= post.id %>/addComment" method="post">
                                    <label class="form-label" for="review">Add Review:</label>
                                    <textarea class="form-control" name="review[body]" id="review" cols="3" rows="2"
                                        required></textarea>
                                    <button class="btn-sm btn-secondary">Post Comment</button>
                                </form>
                                </div>
                                <% } %> 


                                <% if(profile.username == currentUser.username){%>
                                <form action="/friends/<%= profile.id %>/post/<%= post.id %>?_method=DELETE"
                                    method="post">
                               <button class="btn btn-danger btn-sm">Delete</button>
                               </form>
                
                               <% } %> 
                            </li>
                            
                        </ul>
                        <ul>
            
                                <%for(let review of post.reviews){ %>
                                
                                            <p class="card-text"><b><%= review.author %></b> : <%= review.body %>  
                                             <% if(review.author == currentUser.username) {%>
                                                <a class="btn-sm btn-danger" style="text-decoration: none;" href="/friends/<%= profile.id %>/post/<%= post.id %>/deletecomment/<%=review.id%>">Delete</a> 
                                            </p>
                            
                                        <% } }%> 
                                    
                                
                            
                    
                    </div>
                    <% } %>
                    
            </ul>
        

    </div>

    <style>
        .btn-pink{
            color: antiquewhite;
            background-color: rgba(255, 0, 106, 0.747);
        }
        .btn-pink:hover{
            color: maroon;
            background-color: rgb(255, 0, 106);
        }   
     </style>